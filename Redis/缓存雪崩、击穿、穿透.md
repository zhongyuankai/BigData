# 缓存雪崩、击穿、穿透

## 缓存穿透

指查询一个一定不存在的数据。由于缓存命不中时会去查询数据库，查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到数据库去查询，造成缓存穿透。

解决：

1. 接口层增加校验，比如用户鉴权校验，参数做校验，不合法的参数直接代码Return，比如：id 做基础校验，id <=0的直接拦截等。

2. 是将空对象也缓存起来，并给它设置一个很短的过期时间，最长不超过5分钟。

3. 采用布隆过滤器，将所有可能存在的数据哈希到一个足够大的`bitmap`中，一个一定不存在的数据会被这个`bitmap`拦截掉，从而避免了对底层存储系统的查询压力。

## 缓存雪崩

如果缓存集中在一段时间内失效，发生大量的缓存穿透，所有的查询都落在数据库上，可能会导致数据库顶不住挂了。

解决：

1. 把每个Key的失效时间都加个随机值就好了，这样可以保证数据不会在同一时间大面积失效。
2. 设置热点数据永远不过期，有更新操作就更新缓存就好了（比如运维更新了首页商品，那你刷下缓存就完事了，不要设置过期时间），电商首页的数据也可以用这个操作，保险。

## 缓存击穿

是指一个key非常热点，在不停的扛着大并发，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。

解决：

1. 可以设置key永不过期